<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../">
  <title data-ice="title">Manual</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<link rel="stylesheet" href="./inject/css/0-injected-style.css"></head>
<body class="layout-container manual-root" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/README.html"><a href="manual/README.html" data-ice="link">Navigation Meshes Overview </a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#intro" data-ice="link">Intro</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#installation" data-ice="link">Installation</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#as-a-script" data-ice="link">As a Script</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/README.html"><a href="manual/README.html#as-a-module" data-ice="link">As a Module</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#create-a-nav-mesh" data-ice="link">Create a Nav Mesh</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#usage" data-ice="link">Usage</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#performance-comparison" data-ice="link">Performance Comparison</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#development" data-ice="link">Development</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#references" data-ice="link">References</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/README.html"><a href="manual/README.html#todo" data-ice="link">TODO</a></li>
</ul>
  </div>
<div data-ice="manual">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1" data-link="manual/tiled-navmesh-guide.html"><a href="manual/tiled-navmesh-guide.html" data-ice="link">Creating a NavMesh in Tiled</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tiled-navmesh-guide.html"><a href="manual/tiled-navmesh-guide.html#goal" data-ice="link">Goal</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tiled-navmesh-guide.html"><a href="manual/tiled-navmesh-guide.html#snapping-setup" data-ice="link">Snapping Setup</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tiled-navmesh-guide.html"><a href="manual/tiled-navmesh-guide.html#creating-the-mesh" data-ice="link">Creating the Mesh</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tiled-navmesh-guide.html"><a href="manual/tiled-navmesh-guide.html#agent-size--gaps-" data-ice="link">Agent Size (Gaps)</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown" data-ice="content"><h1 id="navigation-meshes-overview------omit-in-toc----">Navigation Meshes Overview <!-- omit in toc --></h1><p>A JS plugin for fast pathfinding using <a href="https://en.wikipedia.org/wiki/Navigation_mesh">navigation meshes</a>, with optional wrappers for the Phaser v2 and Phaser v3 game engines.</p>
<p><a href="https://www.mikewesthad.com/navmesh/demo/"><img src="./manual/./doc-source/single-following-agent.gif" width="400"></a></p>
<p><a href="https://www.mikewesthad.com/navmesh/demo/">Interactive demo</a></p>
<p>Table of Contents:</p>
<ul>
<li><a href="#intro">Intro</a></li>
<li><a href="#installation">Installation</a><ul>
<li><a href="#as-a-script">As a Script</a></li>
<li><a href="#as-a-module">As a Module</a></li>
</ul>
</li>
<li><a href="#create-a-nav-mesh">Create a Nav Mesh</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#performance-comparison">Performance Comparison</a></li>
<li><a href="#development">Development</a></li>
<li><a href="#references">References</a></li>
<li><a href="#todo">TODO</a></li>
</ul>
<h2 id="intro">Intro</h2><p>Pathfinding is essentially solving a maze, finding a path between two points while avoiding obstacles. When pathfinding in games, we need to:</p>
<ol>
<li>Represent the game world in a way that defines what areas are walkable.</li>
<li>Search that representation for the shortest path.</li>
</ol>
<p>When it comes to 2D pathfinding in <a href="http://phaser.io/">Phaser</a>, the <a href="https://github.com/photonstorm/phaser-plugins">packaged solution</a> represents the world using <a href="https://developer.mozilla.org/en-US/docs/Games/Techniques/Tilemaps">tiles</a> (a grid) and then searchs for a path using the <a href="https://en.wikipedia.org/wiki/A*_search_algorithm">A* algorithm</a>. If you have a 50 x 50 tile world, searching for a path involves searching through a representation of the world with up to 2500 locations (nodes).</p>
<p>This plugin uses navigation meshes to simplify that search. Instead of representing the world as a grid of tiles, it represents the walkable areas of the world as a mesh. That means that the representation of the world has far fewer nodes, and hence, can be searched much faster than the grid approach. This approach is 5x - 150x faster than Phaser&apos;s A* plugin (see performance section).</p>
<p>The example map below (left) is a 30 x 30 map. As a grid, there are 900 nodes, but as a navmesh (right) there are 27 nodes (colored rectangles).</p>
<p><img src="./manual/./doc-source/combined.png" width="700"></p>
<p>(Note: if you are viewing this on GitHub or NPM, you might want to check out the HTML documentation <a href="https://www.mikewesthad.com/navmesh/docs/">here</a>.)</p>
<h2 id="installation">Installation</h2><p>This repo contains 3 related JS modules:</p>
<ul>
<li><code>navmesh</code> - core logic, game-engine agnostic, usable outside of Phaser.</li>
<li><code>phaser-navmesh</code> - Phaser v3 wrapper around <code>navmesh</code> that creates a Phaser 3 Scene plugin. Phaser 3 is expected to be a dependency in your project.</li>
<li><code>phaser2-navmesh</code> - Phaser v2 wrapper around <code>navmesh</code> that creates a Phaser 2 game plugin. Phaser 2 or Phaser-ce is expected to be in the global scope.</li>
</ul>
<p>You can use any of them as a script or as a module.</p>
<h3 id="as-a-script">As a Script</h3><p>Download the distribution version that you want:</p>
<table>
<thead>
<tr>
<th>navmesh</th>
<th>phaser-navmesh</th>
<th>phaser2-navmesh</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://raw.githubusercontent.com/mikewesthad/navmesh/master/packages/navmesh/dist/navmesh.min.js">minified</a> &amp; source <a href="https://raw.githubusercontent.com/mikewesthad/navmesh/master/packages/navmesh/dist/navmesh.min.js.map">map</a></td>
<td><a href="https://raw.githubusercontent.com/mikewesthad/navmesh/master/packages/phaser-navmesh/dist/phaser-navmesh.min.js">minified</a> &amp; source <a href="https://raw.githubusercontent.com/mikewesthad/navmesh/master/packages/phaser-navmesh/dist/phaser-navmesh.min.js.map">map</a></td>
<td><a href="https://raw.githubusercontent.com/mikewesthad/navmesh/master/packages/phaser2-navmesh/dist/phaser2-navmesh.min.js">minified</a> &amp; source <a href="https://raw.githubusercontent.com/mikewesthad/navmesh/master/packages/phaser2-navmesh/dist/phaser2-navmesh.min.js.map">map</a></td>
</tr>
<tr>
<td><a href="https://raw.githubusercontent.com/mikewesthad/navmesh/master/packages/navmesh/dist/navmesh.js">unminified</a> &amp; source <a href="https://raw.githubusercontent.com/mikewesthad/navmesh/master/packages/navmesh/dist/navmesh.js.map">map</a></td>
<td><a href="https://raw.githubusercontent.com/mikewesthad/navmesh/master/packages/phaser-navmesh/dist/phaser-navmesh.js">unminified</a> &amp; source <a href="https://raw.githubusercontent.com/mikewesthad/navmesh/master/packages/phaser-navmesh/dist/phaser-navmesh.js.map">map</a></td>
<td><a href="https://raw.githubusercontent.com/mikewesthad/navmesh/master/packages/phaser2-navmesh/dist/phaser2-navmesh.js">unminified</a> &amp; source <a href="https://raw.githubusercontent.com/mikewesthad/navmesh/master/packages/phaser2-navmesh/dist/phaser2-navmesh.js.map">map</a></td>
</tr>
<tr>
<td>Library Name: NavMesh</td>
<td>Library Name: PhaserNavMeshPlugin</td>
<td>Library Name: Phaser2NavMeshPlugin</td>
</tr>
</tbody>
</table>
<p>E.g. if you wanted phaser-navmesh</p>
<pre><code class="lang-html"><code class="source-code prettyprint">&lt;script src=&quot;dist/phaser-navmesh.min.js&quot;&gt;&lt;/script&gt;</code>
</code></pre>
<p>Inside of your own script, you can now use the global PhaserNavMeshPlugin:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">const game = new Phaser.Game({
  type: Phaser.AUTO,
  width: 750,
  height: 750,
  plugins: {
    scene: [{key: &quot;NavMeshPlugin&quot;, plugin: PhaserNavMeshPlugin, mapping: &quot;navMeshPlugin&quot;, start: true }]
  }
});</code>
</code></pre>
<h3 id="as-a-module">As a Module</h3><p>Install the appropriate dependency:</p>
<ul>
<li><code>npm install --save navmesh</code> for usage outside of Phaser</li>
<li><code>npm install --save phaser-navmesh</code> for Phaser 3</li>
<li><code>npm install --save phaser2-navmesh</code> for Phaser 2</li>
</ul>
<p>To use the transpiled and minified distribution of the library:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">import PhaserNavmesh from &quot;phaser-navmesh&quot;;</code>
</code></pre>
<p>To use the raw library (so you can transpile it to match your own project settings):</p>
<pre><code class="lang-js"><code class="source-code prettyprint">import PhaserNavmesh from &quot;phaser-navmesh/src&quot;;</code>
</code></pre>
<h2 id="create-a-nav-mesh">Create a Nav Mesh</h2><p>See <a href="https://www.mikewesthad.com/navmesh/docs/manual/tiled-navmesh-guide.html">guide</a>.</p>
<h2 id="usage">Usage</h2><pre><code class="lang-js"><code class="source-code prettyprint">// This snippet assumes you&apos;ve got your tilemap loaded in a variable called &quot;tilemap&quot;

// Register the plugin with Phaser
const navMeshPlugin = this.game.plugins.add(phaserNavmesh);

// Load the navMesh from the tilemap object layer &quot;navmesh.&quot; The navMesh was created with 12.5
// pixels of space around obstacles.
const navMesh = navMeshPlugin.buildMeshFromTiled(tilemap, &quot;navmesh&quot;, 12.5);

const p1 = new Phaser.Point(100, 400);
const p2 = new Phaser.Point(700, 200);
const path = navMesh.findPath(p1, p2);
// -&gt; path is now either an array of points, or null if no valid path could be found</code>
</code></pre>
<p>Visually debugging paths:</p>
<pre><code class="lang-js"><code class="source-code prettyprint">navMesh.enableDebug(); // Creates a Phaser.Graphics overlay on top of the screen
navMesh.debugClear(); // Clears the overlay
// Visualize the underlying navmesh
navMesh.debugDrawMesh({
  drawCentroid: true,
  drawBounds: false,
  drawNeighbors: true,
  drawPortals: true
});
// Find &amp; visualize a specific path
const path = navMesh.findPath(follower.position, target, {
  drawPolyPath: true,
  drawFinalPath: true
});</code>
</code></pre>
<h2 id="performance-comparison">Performance Comparison</h2><p><em>(Note: these comparisons were done in any earlier verison of the repo before Phaser v3 was released. The plugins tested haven&apos;t been released in v3 versions yet, so this section could use an update. That said, the results should be the same.)</em></p>
<p>Comparing this navmesh plugin against:</p>
<ul>
<li><a href="https://github.com/photonstorm/phaser-plugins">Phaser&apos;s grid-based A* plugin</a>. Navmesh is approximately 5x - 150x faster.</li>
<li>A faster, grid-based A* search, <a href="https://github.com/prettymuchbryce/easystarjs">EasyStar.js</a>. Navmesh is approximately 5x - 20x faster.</li>
</ul>
<p>Performance depends on the size of the area that needs to be searched. Finding for a path between points that are 50 pixels away is (generally) going to be much faster than finding a path between points that are 5000 pixels away.</p>
<p>Details (see <a href="https://github.com/mikewesthad/navmesh/tree/master/src/examples/performance">src/library/performance</a>):</p>
<pre><code><code class="source-code prettyprint">Performance Comparison, 100000 iterations, 30x30 tilemap

Short paths (150 - 500 pixel length)

    Average time per iteration:
        AStart Plugin: 0.02470ms
        EasyStar Plugin: 0.02876ms
        NavMesh Plugin: 0.00575ms

    Comparison:
        NavMesh is 4.30x faster than Phaser AStar
        NavMesh is 5.00x faster than EasyStar

Long paths (600 pixels and greater length), average time per iteration:

    Average time per iteration:
        AStart Plugin: 1.38710ms
        EasyStar Plugin: 0.15977ms
        NavMesh Plugin: 0.00738ms

    Comparison:
        NavMesh is 187.95x faster than Phaser AStar
        NavMesh is 21.65x faster than EasyStar</code>
</code></pre><h2 id="development">Development</h2><p>Pull requests are welcome! If you want to run this repo locally, make sure you have <a href="https://nodejs.org/en/">node</a> installed. Download the repo, open a terminal in the repo folder and run:</p>
<pre><code><code class="source-code prettyprint">npm install
npm run bootstrap</code>
</code></pre><p>This project uses <a href="https://github.com/lerna/lerna">lerna</a> and <a href="https://yarnpkg.com/lang/en/docs/workspaces/">yarn workspaces</a> to manage multiple packages within one repository. <code>npm install</code> will pull the root dependencies and <code>npm run bootstrap</code> will use lerna &amp; yarn to pull and link dependencies within &quot;packages/&quot;. This project has the following packages:</p>
<ul>
<li><code>navmesh</code> - core logic, game-engine agnostic</li>
<li><code>phaser-navmesh</code> - Phaser Plugin v3 wrapper around <code>navmesh</code></li>
<li><code>phaser2-navmesh</code> - Phaser Plugin v2 wrapper around <code>navmesh</code></li>
</ul>
<p>The project is controlled via npm scripts. The main ones to use:</p>
<ul>
<li><code>npm run build</code> - will build all the individual packages within &quot;packages/&quot;.</li>
<li><code>npm run dev</code> - watch &amp; serve the v3 examples. A browser window will pop up with links to the examples. If you are working on the library, this is the easiest way to do &quot;functional testing&quot; by using the library in a game environment.</li>
<li><code>npm run test</code> - will run the automated tests against the library.</li>
</ul>
<h2 id="references">References</h2><p>Helpful resources used while building this plugin:</p>
<ul>
<li>Inspired by <a href="https://github.com/nickjanssen/PatrolJS">PatrolJS</a>, an implementation of navmeshes for threejs</li>
<li>Navmesh path-finding algorithm explanations:<ul>
<li><a href="http://jceipek.com/Olin-Coding-Tutorials/pathing.html">Game Path Planning by Julian Ceipek</a></li>
<li><a href="http://digestingduck.blogspot.com/2010/03/simple-stupid-funnel-algorithm.html">Simple Stupid Funnel Algorithm</a></li>
</ul>
</li>
<li><a href="http://theory.stanford.edu/~amitp/GameProgramming/Heuristics.html">Advice on astar heuristics</a></li>
</ul>
<h2 id="todo">TODO</h2><ul>
<li>Documentation<ul>
<li>Describe the Tiled process. Adding an object layer, setting snapping, making sure vertices overlap...</li>
</ul>
</li>
<li>Specific Extensions<ul>
<li>Allow non-square navmesh from Tiled - any convex shape</li>
<li>Reimplement the autotessalation version of the lib</li>
<li>Try libtess in quad mode</li>
<li>The astar heuristic &amp; cost functions need another pass. They don&apos;t always produce the shortest path. Implement incomplete funneling while building the astar path?</li>
<li>The navmesh assumes any polygon can reach any other polygon. This probably should be extended to put connected polygons into groups like patroljs.</li>
</ul>
</li>
<li>Testing<ul>
<li>Check against tilemap that is larger than the screen</li>
</ul>
</li>
<li>Research<ul>
<li>There are probably optimization tricks to do when dealing with certain types of shapes. E.g. we are using axis-aligned boxes for the polygons and it is dead simple to calculate if a point is inside one of those...</li>
<li>Investigate <a href="http://www.david-gouveia.com/portfolio/pathfinding-on-a-2d-polygonal-map/">Points-of-Visibility</a> pathfinding to compare speed</li>
</ul>
</li>
</ul>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
